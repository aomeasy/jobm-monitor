name: Job Management Automation



# à¸£à¸±à¸™à¸—à¸¸à¸ 2 à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡à¹ƒà¸™à¸§à¸±à¸™à¸ˆà¸±à¸™à¸—à¸£à¹Œ-à¸¨à¸¸à¸à¸£à¹Œ à¹€à¸§à¸¥à¸² 08:00-17:00 (GMT+7)

# GitHub Actions à¹ƒà¸Šà¹‰ UTC à¸”à¸±à¸‡à¸™à¸±à¹‰à¸™à¸•à¹‰à¸­à¸‡à¸¥à¸š 7 à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡

# 08:00-17:00 GMT+7 = 01:00-10:00 UTC

on:

Â  schedule:

Â  Â  # à¸£à¸±à¸™à¸—à¸¸à¸ 2 à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡: 08:00, 10:00, 12:00, 14:00, 16:00 GMT+7

Â  Â  # UTC: 01:00, 03:00, 05:00, 07:00, 09:00

Â  Â  - cron: '0 1,3,5,7,9 * * 1-5'Â  # à¸™à¸²à¸—à¸µ à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡ à¸§à¸±à¸™ à¹€à¸”à¸·à¸­à¸™ à¸§à¸±à¸™à¹ƒà¸™à¸ªà¸±à¸›à¸”à¸²à¸«à¹Œ

Â Â 

Â  workflow_dispatch:



jobs:

Â  fetch-jobs:

Â  Â  runs-on: ubuntu-latest

Â  Â  timeout-minutes: 15Â  # à¸ˆà¸³à¸à¸±à¸”à¹€à¸§à¸¥à¸²à¹„à¸¡à¹ˆà¹ƒà¸«à¹‰à¹€à¸à¸´à¸™ 15 à¸™à¸²à¸—à¸µ

Â  Â Â 

Â  Â  steps:

Â  Â  Â  - name: Checkout repository

Â  Â  Â  Â  uses: actions/checkout@v4

Â  Â  Â  Â Â 

Â  Â  Â  - name: Set up Python

Â  Â  Â  Â  uses: actions/setup-python@v5

Â  Â  Â  Â  with:

Â  Â  Â  Â  Â  python-version: '3.11'

Â  Â  Â  Â  Â  cache: 'pip'

Â  Â  Â  Â  Â Â 

Â  Â  Â  # à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ Chrome for Testing + Chromedriver à¸—à¸µà¹ˆà¸•à¸£à¸‡à¹€à¸§à¸­à¸£à¹Œà¸Šà¸±à¸™

Â  Â  Â  - name: Setup Chrome

Â  Â  Â  Â  id: chrome

Â  Â  Â  Â  uses: browser-actions/setup-chrome@v1

Â  Â  Â  Â  with:

Â  Â  Â  Â  Â  chrome-version: stable

Â  Â  Â  Â  Â  install-chromedriver: true

Â  Â  Â  Â  Â Â 

Â  Â  Â  - name: Show Chrome info

Â  Â  Â  Â  run: |

Â  Â  Â  Â  Â  echo "Chrome: ${{ steps.chrome.outputs.chrome-path }}"

Â  Â  Â  Â  Â  echo "Driver: ${{ steps.chrome.outputs.chromedriver-path }}"

Â  Â  Â  Â  Â  ${{ steps.chrome.outputs.chrome-path }} --version

Â  Â  Â  Â  Â  ${{ steps.chrome.outputs.chromedriver-path }} --version

Â  Â  Â  Â  Â Â 

Â  Â  Â  - name: Install system deps for headless (Ubuntu 24.04/Noble)

Â  Â  Â  Â  env:

Â  Â  Â  Â  Â  DEBIAN_FRONTEND: noninteractive

Â  Â  Â  Â  run: |

Â  Â  Â  Â  Â  sudo apt-get update -y

Â  Â  Â  Â  Â  sudo apt-get install -y --no-install-recommends \

Â  Â  Â  Â  Â  Â  xvfb \

Â  Â  Â  Â  Â  Â  libnss3 \

Â  Â  Â  Â  Â  Â  libxss1 \

Â  Â  Â  Â  Â  Â  libgbm1 \

Â  Â  Â  Â  Â  Â  libgtk-3-0 \

Â  Â  Â  Â  Â  Â  libxshmfence1 \

Â  Â  Â  Â  Â  Â  libdrm2 \

Â  Â  Â  Â  Â  Â  libx11-6 \

Â  Â  Â  Â  Â  Â  libxcomposite1 \

Â  Â  Â  Â  Â  Â  libxdamage1 \

Â  Â  Â  Â  Â  Â  libxrandr2 \

Â  Â  Â  Â  Â  Â  libglib2.0-0 \

Â  Â  Â  Â  Â  Â  libgdk-pixbuf2.0-0 \

Â  Â  Â  Â  Â  Â  fonts-liberation \

Â  Â  Â  Â  Â  Â  xdg-utils \

Â  Â  Â  Â  Â  Â  ca-certificates \

Â  Â  Â  Â  Â  Â  libasound2t64

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  - name: Install Python dependencies

Â  Â  Â  Â  run: |

Â  Â  Â  Â  Â  python -m pip install --upgrade pip

Â  Â  Â  Â  Â  pip install -r requirements.txt

Â  Â  Â  Â  Â Â 

Â  Â  Â  - name: Check timezone and current time

Â  Â  Â  Â  run: |

Â  Â  Â  Â  Â  echo "Current UTC time: $(date -u)"

Â  Â  Â  Â  Â  echo "Bangkok time (GMT+7): $(TZ='Asia/Bangkok' date)"

Â  Â  Â  Â  Â  echo "Current hour in Bangkok: $(TZ='Asia/Bangkok' date +'%H')"

Â  Â  Â  Â  Â Â 

Â  Â  Â  - name: Verify business hours

Â  Â  Â  Â  run: |

Â  Â  Â  Â  Â  CURRENT_HOUR=$(TZ='Asia/Bangkok' date +'%H')

Â  Â  Â  Â  Â  CURRENT_DOW=$(TZ='Asia/Bangkok' date +'%u')Â  # 1=Monday, 7=Sunday

Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  echo "Bangkok hour: $CURRENT_HOUR, Day of week: $CURRENT_DOW"

Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  if [ $CURRENT_DOW -ge 1 ] && [ $CURRENT_DOW -le 5 ]; then

Â  Â  Â  Â  Â  Â  if [ $CURRENT_HOUR -ge 8 ] && [ $CURRENT_HOUR -le 17 ]; then

Â  Â  Â  Â  Â  Â  Â  echo "âœ… Within business hours (Mon-Fri 08:00-17:00 Bangkok time)"

Â  Â  Â  Â  Â  Â  Â  echo "SHOULD_RUN=true" >> $GITHUB_ENV

Â  Â  Â  Â  Â  Â  else

Â  Â  Â  Â  Â  Â  Â  echo "â° Outside business hours"

Â  Â  Â  Â  Â  Â  Â  echo "SHOULD_RUN=false" >> $GITHUB_ENV

Â  Â  Â  Â  Â  Â  fi

Â  Â  Â  Â  Â  else

Â  Â  Â  Â  Â  Â  echo "ðŸ“… Weekend - not running"

Â  Â  Â  Â  Â  Â  echo "SHOULD_RUN=false" >> $GITHUB_ENV

Â  Â  Â  Â  Â  fi

Â  Â  Â  Â  Â Â 

Â  Â  Â  - name: Create Google Service Account credentials (raw JSON)

Â  Â  Â  Â  if: env.SHOULD_RUN == 'true'

Â  Â  Â  Â  run: |

Â  Â  Â  Â  Â  printf '%s' '${{ secrets.GOOGLE_SERVICE_ACCOUNT_JSON }}' > credentials.json

Â  Â  Â  Â  Â  python - <<'PY'

Â  Â  Â  Â  Â  import json, pathlib, sys

Â  Â  Â  Â  Â  p = pathlib.Path("credentials.json")

Â  Â  Â  Â  Â  data = p.read_text(encoding="utf-8")

Â  Â  Â  Â  Â  try:

Â  Â  Â  Â  Â  Â  Â  json.loads(data)

Â  Â  Â  Â  Â  except Exception as e:

Â  Â  Â  Â  Â  Â  Â  sys.exit(f"credentials.json is not valid JSON: {e}")

Â  Â  Â  Â  Â  print("âœ… credentials.json written and valid")

Â  Â  Â  Â  Â  PY

Â  Â  Â  Â  Â Â 

Â  Â  Â  - name: Run job fetcher

Â  Â  Â  Â  if: env.SHOULD_RUN == 'true'

Â  Â  Â  Â  env:

Â  Â  Â  Â  Â  CHROME_BIN: ${{ steps.chrome.outputs.chrome-path }}

Â  Â  Â  Â  Â  CHROMEDRIVER: ${{ steps.chrome.outputs.chromedriver-path }}

Â  Â  Â  Â  Â  # à¹ƒà¸Šà¹‰à¸„à¹ˆà¸² default à¸«à¸²à¸à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸•à¸±à¹‰à¸‡ secrets

Â  Â  Â  Â  Â  GOOGLE_SHEET_KEY: ${{ secrets.GOOGLE_SHEET_KEY || '1uEbsT3PZ8tdwiU1Xga_hS6uPve2H74xD5wUci0EcT0Q' }}

Â  Â  Â  Â  Â  GOOGLE_SHEET_NAME: ${{ secrets.GOOGLE_SHEET_NAME || 'à¸Šà¸µà¸•1' }}

Â  Â  Â  Â  Â  GOOGLE_SHEET_URL: ${{ secrets.GOOGLE_SHEET_URL || 'https://docs.google.com/spreadsheets/d/1uEbsT3PZ8tdwiU1Xga_hS6uPve2H74xD5wUci0EcT0Q/edit#gid=0' }}

Â  Â  Â  Â  Â  WORKER_PUSH_URL: ${{ secrets.WORKER_PUSH_URL }}

Â  Â  Â  Â  Â  LINE_TO: ${{ secrets.LINE_TO }}

Â  Â  Â  Â  run: |

Â  Â  Â  Â  Â  echo "ðŸš€ Starting job fetcher at $(TZ='Asia/Bangkok' date)"

Â  Â  Â  Â  Â  python job_fetcher.py

Â  Â  Â  Â  Â  echo "âœ… Job fetcher completed at $(TZ='Asia/Bangkok' date)"

Â  Â  Â  Â  Â Â 

Â  Â  Â  - name: Skip execution (outside business hours)

Â  Â  Â  Â  if: env.SHOULD_RUN == 'false'

Â  Â  Â  Â  run: |

Â  Â  Â  Â  Â  echo "â­ï¸ Skipping execution - outside business hours"

Â  Â  Â  Â  Â  echo "Business hours: Monday-Friday 08:00-17:00 Bangkok time"

Â  Â  Â  Â  Â  echo "Scheduled every 2 hours: 08:00, 10:00, 12:00, 14:00, 16:00"

Â  Â  Â  Â  Â Â 

Â  Â  Â  - name: Clean up credentials

Â  Â  Â  Â  if: always()

Â  Â  Â  Â  run: |

Â  Â  Â  Â  Â  rm -f credentials.json

Â  Â  Â  Â  Â  echo "ðŸ§¹ Credentials cleaned up"

Â  Â  Â  Â  Â Â 

Â  Â  Â  - name: Upload logs (if failed)

Â  Â  Â  Â  if: failure()

Â  Â  Â  Â  uses: actions/upload-artifact@v4

Â  Â  Â  Â  with:

Â  Â  Â  Â  Â  name: job-fetcher-logs-${{ github.run_number }}

Â  Â  Â  Â  Â  path: |

Â  Â  Â  Â  Â  Â  *.log

Â  Â  Â  Â  Â  Â  *.png

Â  Â  Â  Â  Â  retention-days: 3
